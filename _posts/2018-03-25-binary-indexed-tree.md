---
layout: post
title:  "Binary Indexed Tree"
date:   2018-03-25 00:00:00 +0530
tags: competitive-programming fenwick-tree binary-indexed-tree bit
comments: true
meta:
    keywords: "competitive programming, binary indexed tree, bit, fenwick tree"
---
<!-- Load MathJax -->
<script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

Previous week, we saw how we can use Square root decomposition to solve our [problem]. This week, we will see how we can solve the same problem by using a different technique called
**Binary Indexed Tree** (also called **Fenwick Tree**).

Binary Indexed tree is a useful technique when we are dealing with a dynamic array of data where following type of queries are required -
- Type 1 - Change the value of the element at a given position
- Type 2 - Calculate the sum of the values from starting to a given position (also called prefix sums)

# Idea #

First let's see a naive approach to solving this problem.

<script src="https://gist.github.com/kishuagarwal/f386f7385fde022192c2c87ede14bb3d.js"></script>


This approach is simple to code and understand, but is very inefficient when dealing with large array having large number of queries of type $$1$$ and type $$2$$.

For query of type $$2$$, it takes $$O(1)$$ time, but for the query of type $$1$$, it takes $$O(N)$$ time as whenever array values are updated, it will recalculate the prefix sums for each position of the array.

The basic idea in this naive approach was to decrease the time for query of type $$2$$ by having precalculated all the prefix sums. But in doing so, it sacrificed the time for handling queries of type $$1$$. This approach would have been not that bad, if the queries were mostly of type 2 and the data rarely changed. But in most cases that wouldn't be the case. So let's work on improving this stategy.

Instead of precomputing the prefix sums for all the positions on any data change, instead we can try precomputing the values for only the specific positions in the array. But which positions?

**Peter Fenwick** proposed selecting the positions based on the binary representation of the array indices (and not the values themselves at those array indices). He also suggested that instead of directly storing the prefix sums, we can store them in chunks. Don't worry, all of this would get clear as we go along.

Let's call our data structure holding this new information **bit_tree** (short for Binary Indexed tree). This will also
be an array like our prefix sums array, but only storing information a bit differently. You may ask why this is called a tree then? Well, this is similar to how heaps can be imagined as a tree like structure, but can be implemented using an array. 


Fenwick's idea was that any array index of the **bit_tree**, would not hold the prefix sum like we did above, but sum of only those elements of the original array, which are dictated by the **last set bit** in the binary representation of the array index. Let's try to understand this by an example.

Suppose we are at array index $$7$$ in our **bit_tree**. In our naive approach we would have stored the sum of all elements from starting till the index $$7$$ of our original array. But according to Fenwick, we have to consider the binary representation of $$7$$ to find out sum of which elements has to be stored at index $$7$$.

Binary of $$7$$ is $$111$$. The **last set bit** of this representation is at position $$0$$ (counting from right), representing decimal number $$1$$. Which means that index $$7$$ would hold sum of just $$1$$ number which is nothing but the value at index $$7$$ of the original array.

Similarly if we consider the position $$6$$. Binary of $$6$$ is $$110$$. The last set bit here is at position $$1$$ which represents decimal number $$2$$. Thus it holds sum of two numbers from index $$5$$ to $$6$$ in the original array.

Note that the elements to sum are considered from the current index and moving towards the left. 

<div class="img_container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="583px" version="1.1" viewBox="0 0 583 291" style="max-width:100%;max-height:291px;"><defs/><g transform="translate(0.5,0.5)"><rect x="2" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(23.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">2</text></switch></g><rect x="52" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(73.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><rect x="102" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(123.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="152" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(173.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">6</text></switch></g><rect x="202" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(223.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><rect x="252" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(273.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="302" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(323.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8</text></switch></g><rect x="352" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(373.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="402" y="15" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(423.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><path d="M 509.5 13.75 C 495.5 13.75 492 27.5 503.2 30.25 C 492 36.3 504.6 49.5 513.7 44 C 520 55 541 55 548 44 C 562 44 562 33 553.25 27.5 C 562 16.5 548 5.5 535.75 11 C 527 2.75 513 2.75 509.5 13.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(507.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="38" height="27" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 40px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">original<br />array<br /></div></div></foreignObject><text x="19" y="20" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 492.01 28 L 472 28 L 472 30 L 458.37 30" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 453.12 30 L 460.12 26.5 L 458.37 30 L 460.12 33.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="2" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="52" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="102" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="152" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(169.5,193.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">12</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">12</text></switch></g><rect x="202" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="252" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(273.5,193.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8</text></switch></g><rect x="302" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(323.5,193.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8</text></switch></g><rect x="352" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="402" y="185" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(18.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">1</text></switch></g><g transform="translate(68.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">2</text></switch></g><g transform="translate(118.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">3</text></switch></g><g transform="translate(168.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">4</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">4</text></switch></g><g transform="translate(223.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">5</text></switch></g><g transform="translate(268.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">6</text></switch></g><g transform="translate(318.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">7</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">7</text></switch></g><g transform="translate(368.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">8</text></switch></g><g transform="translate(418.5,229.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">9</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">9</text></switch></g><path d="M 7 65 L 167 65 Q 177 65 177 75 L 177 168.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 177 173.88 L 173.5 166.88 L 177 168.63 L 180.5 166.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 212 65 L 267 65 Q 277 65 277 75 L 277 168.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 277 173.88 L 273.5 166.88 L 277 168.63 L 280.5 166.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 312 65 L 322 65 Q 332 65 332 75 L 332 168.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 332 173.88 L 328.5 166.88 L 332 168.63 L 335.5 166.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 519.5 178.75 C 505.5 178.75 502 192.5 513.2 195.25 C 502 201.3 514.6 214.5 523.7 209 C 530 220 551 220 558 209 C 572 209 572 198 563.25 192.5 C 572 181.5 558 170.5 545.75 176 C 537 167.75 523 167.75 519.5 178.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(516.5,186.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="40" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 41px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">bit_tree</div></div></foreignObject><text x="20" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">bit_tree</text></switch></g><path d="M 502.01 193 L 477 193 L 477 208 L 458.37 208" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 453.12 208 L 460.12 204.5 L 458.37 208 L 460.12 211.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 529.5 248.75 C 515.5 248.75 512 262.5 523.2 265.25 C 512 271.3 524.6 284.5 533.7 279 C 540 290 561 290 568 279 C 582 279 582 268 573.25 262.5 C 582 251.5 568 240.5 555.75 246 C 547 237.75 533 237.75 529.5 248.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(532.5,256.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="29" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 30px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">index</div></div></foreignObject><text x="15" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">index</text></switch></g><path d="M 512.01 263 L 482 263 L 482 235 L 458.37 235" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 453.12 235 L 460.12 231.5 L 458.37 235 L 460.12 238.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/></g></svg>
</div>


In the above figure, I have shown the sum stored at position $$4$$, $$6$$ and $$7$$ of **bit_tree**. As you can see, at position $$7$$, only sum of one value is stored. At position $$6$$, sum of two values is stored. And at position $$4$$, sum of $$4$$ values are stored since binary of $$4$$ is $$100$$ and the last set bit represents decimal number $$4$$.


Let's see how storing the sums this way, helps us in performing the $$2$$ queries above.

# Type 1 #

For handling queries of type $$1$$, where we have to update the element at index $$i$$ in the array, we can update all the indices in the **bit_tree** which cover the index $$i$$ being updated. Let's understand this with the help of the following figure.

<div class="img_container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="581px" version="1.1" viewBox="0 0 581 301" style="max-width:100%;max-height:301px;"><defs/><g transform="translate(0.5,0.5)"><rect x="0" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(21.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">2</text></switch></g><rect x="50" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(71.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><rect x="100" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(121.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="150" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(171.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">6</text></switch></g><rect x="200" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(221.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><rect x="250" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(271.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="300" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(321.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8</text></switch></g><rect x="350" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(371.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="400" y="25" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(421.5,33.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><path d="M 507.5 23.75 C 493.5 23.75 490 37.5 501.2 40.25 C 490 46.3 502.6 59.5 511.7 54 C 518 65 539 65 546 54 C 560 54 560 43 551.25 37.5 C 560 26.5 546 15.5 533.75 21 C 525 12.75 511 12.75 507.5 23.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(505.5,23.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="38" height="27" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 40px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">original<br />array<br /></div></div></foreignObject><text x="19" y="20" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 490.01 38 L 470 38 L 470 40 L 456.37 40" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 451.12 40 L 458.12 36.5 L 456.37 40 L 458.12 43.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="0" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="50" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(71.5,203.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="100" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="150" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(167.5,203.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">12</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">12</text></switch></g><rect x="200" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="250" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="300" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="350" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(367.5,203.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">33</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">33</text></switch></g><rect x="400" y="195" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(16.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">1</text></switch></g><g transform="translate(66.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">2</text></switch></g><g transform="translate(116.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">3</text></switch></g><g transform="translate(166.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">4</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">4</text></switch></g><g transform="translate(221.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">5</text></switch></g><g transform="translate(266.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">6</text></switch></g><g transform="translate(316.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">7</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">7</text></switch></g><g transform="translate(366.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">8</text></switch></g><g transform="translate(416.5,239.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">9</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">9</text></switch></g><path d="M 20 75 L 370 75 Q 380 75 380 85 L 380 178.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 380 183.88 L 376.5 176.88 L 380 178.63 L 383.5 176.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 517.5 188.75 C 503.5 188.75 500 202.5 511.2 205.25 C 500 211.3 512.6 224.5 521.7 219 C 528 230 549 230 556 219 C 570 219 570 208 561.25 202.5 C 570 191.5 556 180.5 543.75 186 C 535 177.75 521 177.75 517.5 188.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(514.5,196.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="40" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 41px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">bit_tree<br /></div></div></foreignObject><text x="20" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">bit_tree&lt;br&gt;</text></switch></g><path d="M 500.01 203 L 475 203 L 475 218 L 456.37 218" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 451.12 218 L 458.12 214.5 L 456.37 218 L 458.12 221.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 527.5 258.75 C 513.5 258.75 510 272.5 521.2 275.25 C 510 281.3 522.6 294.5 531.7 289 C 538 300 559 300 566 289 C 580 289 580 278 571.25 272.5 C 580 261.5 566 250.5 553.75 256 C 545 247.75 531 247.75 527.5 258.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(530.5,266.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="29" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 30px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">index</div></div></foreignObject><text x="15" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">index</text></switch></g><path d="M 510.01 273 L 480 273 L 480 245 L 456.37 245" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 451.12 245 L 458.12 241.5 L 456.37 245 L 458.12 248.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 20 95 L 170 95 Q 180 95 180 105 L 180 168.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 180 173.88 L 176.5 166.88 L 180 168.63 L 183.5 166.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 20 135 L 70 135 Q 80 135 80 145 L 80 168.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 80 173.88 L 76.5 166.88 L 80 168.63 L 83.5 166.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 60 65 L 90 15" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(91.5,2.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="15" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 14px">5</font></div></div></foreignObject><text x="4" y="13" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 63 225 L 90 185" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(91.5,167.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="13" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 13px">7</font></div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 170 225 L 190 180" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(191.5,163.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="13" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 13px">14</font></div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 360 225 L 390 181" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(386.5,167.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="13" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 13px">35</font></div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
</div>

Here, we have shown sums for $$3$$ positions, $$2$$, $$4$$ and $$8$$. We want to change the value of element at position $$2$$ from $$3$$ to $$5$$. In the naive approach from above, after changing the value of the element in the original array, we would have recomputed the prefix sums for whole of the positions in the prefix array. But in our new approach, we would only have to change the value of $$3$$ positions. Why these $$3$$ only?

We would definitely would have to change the value at position $$2$$ since it covers index 2 of our original array. To maintain the integrity of the sums stored in all the other indices in our **bit_tree**, we would also have to change all those values which were calculated using the value at index $$2$$ in our original array. And how can we figure out those indices?

Before answering that question, let's consider another problem. Given a number $$x$$, how can we quickly find the last set bit of that number.
Let's represent the number $$x$$ in binary as **$$s1t$$** where $$1$$ represents the last set bit, $$t$$ representing sequence of zero or more $$0$$'s at the end and $$s$$ representing the start of the number. Let's add $$-x$$ to $$x$$. $$-x$$ would be just $$1$$ added to the $$1$$-complement of $$x$$.

$$-x = 1 + \overline{s1t} = 1 + \overline{s}0{111...1} = \overline{s}1t$$

And now take bitwise $$\&$$ of $$x$$ and $$-x$$.

$$x \, \& \, -x = s1t \, \& \, \overline{s}1t = 1t $$

Which gives us the last set bit of $$x$$ because $$t$$ is just sequence of $$0$$'s. You can verify that this works by taking an example.

Let's continue now answering our previous question of determining which indices need to be updated. To find this, first we will find the last set bit of the current index and add it to current index to get the next index to update. So after having updated the value at position $$2$$, we will then find the last set bit of $$2$$ which would be $$2$$ again. We will then add this $$2$$(last set bit) to the $$2$$(current index) to get $$4$$. $$4$$ is thus the next index which we need to update. And similarly we will update $$8$$ which is the next index to update after $$4$$.

So, to find the next index to update after updating the current index $$i$$, following equation is used.

$$ i_{next} = i + (i \, \& -i)$$

which basically tells us to add the last set bit from the current index to get the next index.

Time complexity of the update function would be number of bits in $$n$$ which is nothing but $$O(log(n))$$.

Below is a sample implementation of this update function in Python. Notice how small, clean and easy to understand the function is.

<script src="https://gist.github.com/kishuagarwal/376f88804c1af082a1e8c99d2ce892ad.js"></script>

# Type 2 #

For queries of type $$2$$, we have to find the prefix sum for the first $$i$$ elements.
Type 2 query can be also of type where we are given two indices $$l$$ and $$r$$ and we have to find the range sum between these two indices. But these can also be solved by our first representation. Range sum between $$l$$ and $$r$$ is only difference between prefix sum till $$r$$ and $$l-1$$.


With the way the sums are stored in our data structure, answering queries of type 2 are very simple. We start with the $$i^{th}$$ element in **bit_tree**. Now this index would hold the sum of some elements of our original array but not all. We will then find the next index, which holds the sum of the remaining elements and continue on from there till we have found the sum of all the elements. To find the next index from the current index $$i$$, following equation is used.

$$ i_{next} = i - (i \, \& -i)$$

which basically tells us to subtract the last set bit from the current index to get the next index.

<div class="img_container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="581px" version="1.1" viewBox="0 0 581 225" style="max-width:100%;max-height:225px;"><defs/><g transform="translate(0.5,0.5)"><rect x="0" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="50" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="100" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="150" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(167.5,28.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">12</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">12</text></switch></g><rect x="200" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="250" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(271.5,28.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8</text></switch></g><rect x="300" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(321.5,28.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8</text></switch></g><rect x="350" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="400" y="20" width="50" height="30" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(16.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">1</text></switch></g><g transform="translate(66.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">2</text></switch></g><g transform="translate(116.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">3</text></switch></g><g transform="translate(166.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">4</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">4</text></switch></g><g transform="translate(221.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">5</text></switch></g><g transform="translate(266.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">6</text></switch></g><g transform="translate(316.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">7</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">7</text></switch></g><g transform="translate(366.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">8</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">8</text></switch></g><g transform="translate(416.5,64.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">9</div></div></foreignObject><text x="3" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">9</text></switch></g><path d="M 20 215.5 L 183.63 215.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 188.88 215.5 L 181.88 219 L 183.63 215.5 L 181.88 212 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 517.5 13.75 C 503.5 13.75 500 27.5 511.2 30.25 C 500 36.3 512.6 49.5 521.7 44 C 528 55 549 55 556 44 C 570 44 570 33 561.25 27.5 C 570 16.5 556 5.5 543.75 11 C 535 2.75 521 2.75 517.5 13.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(514.5,21.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="40" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 41px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">bit_tree</div></div></foreignObject><text x="20" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">bit_tree</text></switch></g><path d="M 500.01 28 L 475 28 L 475 43 L 456.37 43" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 451.12 43 L 458.12 39.5 L 456.37 43 L 458.12 46.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 527.5 83.75 C 513.5 83.75 510 97.5 521.2 100.25 C 510 106.3 522.6 119.5 531.7 114 C 538 125 559 125 566 114 C 580 114 580 103 571.25 97.5 C 580 86.5 566 75.5 553.75 81 C 545 72.75 531 72.75 527.5 83.75 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(530.5,91.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="29" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 30px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">index</div></div></foreignObject><text x="15" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">index</text></switch></g><path d="M 510.01 98 L 480 98 L 480 70 L 456.37 70" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 451.12 70 L 458.12 66.5 L 456.37 70 L 458.12 73.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(311.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="33" height="13" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 13px">= 111</font></div></div></foreignObject><text x="17" y="12" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 217.5 175.5 L 283.63 175.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 288.88 175.5 L 281.88 179 L 283.63 175.5 L 281.88 172 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 315 150 L 320 150 Q 325 150 317.5 150 L 313.75 150 Q 310 150 320 150.12 L 343.63 150.42" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 348.88 150.49 L 341.84 153.9 L 343.63 150.42 L 341.93 146.9 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><image x="185.5" y="185" width="20" height="20" xlink:href="https://cdn0.iconfinder.com/data/icons/slim-square-icons-basics/100/basics-15-128.png" preserveAspectRatio="none" pointer-events="none"/><image x="289.5" y="150" width="20" height="20" xlink:href="https://cdn0.iconfinder.com/data/icons/slim-square-icons-basics/100/basics-15-128.png" preserveAspectRatio="none" pointer-events="none"/><image x="369.5" y="165" width="20" height="20" xlink:href="https://cdn2.iconfinder.com/data/icons/picol-vector/32/equal-128.png" preserveAspectRatio="none" pointer-events="none"/><g transform="translate(156.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="33" height="13" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 13px">= 100</font></div></div></foreignObject><text x="17" y="12" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(256.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="33" height="13" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 13px">= 110</font></div></div></foreignObject><text x="17" y="12" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(411.5,168.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="18" height="17" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="font-size: 16px">28</font></div></div></foreignObject><text x="9" y="14" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
</div>


In the above figure, we are interested in finding the prefix sum for the first $$7$$ elements. We start with the $$7^{th}$$ position in the **bit_tree**, and add its value($$8$$) to our answer. But this holds the sum for only element. To find the next index to consider, we write $$7$$ in the binary representation and subtract the last set bit, which would give us $$6$$. We again add this value($$8$$) to our answer. This holds sum of two values. We again find the next index by subtracting the last set bit from the current index. This would give us $$4$$. We add (12) to our answer. This holds the sum of first $$4$$ values. Now when we find the next index, we would reach $$0$$ which signifies that we have added all the sums chunks to get the prefix sum for the first $$7$$ elements i.e. $$28$$.


Time complexity of the query function is also $$O(log(n))$$.

Here is a sample implementation of the query function in Python.

<script src="https://gist.github.com/kishuagarwal/bfdf04a73e6a724bd08360cbe69fa887.js"></script>



Here is the complete implementation of the binary indexed tree in Python 3.

<script src="https://gist.github.com/kishuagarwal/0c0369faf24cae894e172888d750915a.js"></script>

Time complexity of binary indexed tree is inclusive of time required to initially build the tree which is $$O(n*log(n))$$ and time required to answer queries $$O(q * log(n))$$ giving the total time complexity of $$O(n*log(n) + q * log(n))$$.


Space complexity of binary indexed tree is $$O(n)$$ since it requires a separate array to hold the precomputed information.


# Solution #
Now let's use the idea of binary indexed tree to solve the problem from the previous week.

Here we have to find the $$k^{th}$$ odd number in our array. To solve this problem using binary indexed tree, we can use a slight variation in our sum storage.

Instead of storing sum of array values directly, we can only store whether the number is odd or not. So if the number is odd, that would be considered as a number $$1$$, and otherwise $$0$$. So, this way, our **bit_tree** would hold the count of odd numbers till any position in our array.

To handle query of type 1, we can simply check whether the updated value is odd or not. If the updated value is odd, then we can simply update the corresponding index by 1, else we would have to decrease the index by 1 (or in other words, increase it by -1). 


Now queries of type 2 are more interesting. How can we find the $$k^{th}$$ odd number? Here we can use binary search over **bit_tree** for **k**. We can use binary search here, because **bit_tree** satisfies the two conditions of applying binary search. The data in **bit_tree** is sorted in increasing order of count of odd numbers found. And for any **k**, there exists a index for which all the indices to the left of it, would have odd number count less than it and all the indices to the right, would have odd number count greater than it.

Here is a my sample implementation in Python 3.

<script src="https://gist.github.com/kishuagarwal/6708744e675b258b6dc07f44a95b6955.js"></script>

So, to summarize, binary indexed tree is a good data structure to know and have in your toolbox.


Thank you for reading my article. Let me know if you liked my article or any other suggestions for me, in the comments section below. And please, feel free to share :)

[problem]: https://www.hackerearth.com/practice/data-structures/advanced-data-structures/segment-trees/practice-problems/algorithm/help-mona/
[HackerEarth]: https://www.hackerearth.com
[here]: https://www.hackerearth.com/practice/algorithms/advanced-algorithms/square-root-decomposition/practice-problems/
