---
layout: post
title:  "Square Root Decomposition"
date:   2018-03-18 00:00:00 +0530
tags: competitive-programming sqrt-root decomposition
comments: true
meta:
    keywords: "competitive programming, square root decomposition, sqrtroot decomposition"
---
<!-- Load MathJax -->
<script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


Let's consider the [Problem Statement] from [HackerEarth].

Basically, you are given an array $$A$$ of size $$N$$ and $$Q$$ queries. Each query can be of two types -
- $$1$$ $$i$$ - add $$1$$ to the $$i^{th}$$ element of the array $$A$$
- $$2$$ $$K$$ - print the $$K^{th}$$ odd number of the array $$A$$ if it exists, else print $$-1$$

And all the indexes are $$1$$-based.

So how can we solve this problem.
Let's try bruteforce approach. Here is a sample implementation in Python 3.

{% highlight python %}
n, q = list(map(int, input()s.strip().split(' ')))
array = list(map(int, input().strip().split(' ')))
for i in range(q):
    typ, k = list(map(int, input().strip().split(' ')))
    if typ == 1:
        array[k - 1] += 1
    else:
        odd_count = 0
        found_at = -1
        for index, num in enumerate(array):
            if num & 1 > 0:
                odd_count += 1
                if odd_count == k:
                    found_at = index + 1
                    break
        print(found_at)
{% endhighlight %}

Here we are simply iterating over the queries. And depending on whether the query is of type $$1$$ or type $$2$$, we either update the corresponding $$i^{th}$$ entry in the array or loop over all the elements to find the $$K^{th}$$ odd number.

But this approach would only work when the input size is small. For this problem, the input array could be as large as $$2 * 10 ^ 6$$ and the number of queries could also be as large as $$2 * 10 ^ 6$$. In the worst case (that would occur when the $$K^{th}$$ odd number doesn't exists and all the queries are of type $$2$$), this would mean iterating over whole of the array of size $$2 * 10 ^ 6$$, $$2 * 10 ^ 6$$ times. Which is clearly not gonna cut it.

Thankfully, we can solve this problem under the given constraints with a neat little technique called **Square root decomposition**. 


# Idea #
Main idea behind the Square root decomposition method is to divide our original array into buckets of equal size, usually $$\sqrt{n}$$ where $$n$$ is the size of the original array.

Dividing the array into the buckets allows us to precompute some information about those buckets and later reuse them when given some query over the array.

For example, suppose we have to find some information about a range $$l$$ to $$r$$. Now the given query range would be covering some of the buckets partially and others completely. Now the thing to note is that there could only be at most $$2$$ partially covered buckets. One on the left and one on the right of the query range.

For all the completely covered buckets, we won't have to compute anything. We could directly use the precomputed information from above.

Only for these $$2$$ partially covered buckets, we would have to go inside those buckets, and compute the necessary information.

Finally, we can merge the collected information from these buckets to answer the given query.

In case we need to update the value of some array element, we would only need to recompute the information for the corresponding bucket only. And that could be done in $$O(\sqrt{N})$$ time.

# Solution #

Now having gone through the basic idea of the Square Root Decomposition, let's see how we can use this to solve our original problem statement.

First we will divide the original array into $$\sqrt{n}$$ buckets. Here $$n$$ is at most $$2 * 10 ^ 6$$, so number of buckets could be atmost $$\lceil\sqrt{2 * 10 ^ 6}\rceil=1415$$ and there would be $$\lceil\frac{2 * 10 ^ 6}{1415}\rceil=1414$$ numbers in each bucket with the last bucket having just $$2 * 10 ^ 6 mod 1414=604$$ elements.

<div class="img_container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="691px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36&quot; version=&quot;8.4.7&quot; editor=&quot;www.draw.io&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;f8bf9ac0-97a7-b5a9-90ff-45edba70f58b&quot; name=&quot;Page-1&quot;&gt;7ZpNk+IoGMc/jVUzB7sIJDEep+3e3cNOzVZ52JkjnWDCNIYMwVb30y8EYpImuk6V2mzXeNDw8Pbw5/ckQJygxXr3u8BV8ZlnhE0gyHYT9DCBcD4H6lsb9sYQxTNjyAXNjCnoDEv6D7FGWy/f0IzUg4KScyZpNTSmvCxJKgc2LATfDoutOBv2WuGcOIZliplr/ZtmsjDWJAKd/Q9C86LtOQA25wmnz7ngm9L2N4Fo1XxM9hq3bdnydYEzvu2Z0OMELQTn0lytdwvCtLStbKbeb0dyD34LUspzKkAUBPP5LEtI+JQQQqbItPCC2cZqAa2nct+q04yP6BbABN1vCyrJssKpzt0qHJStkGumUoG6TPmapraobZsISXZHHQ4OMii6CF8TKfaqiK0QwrvI1NkftDfpbTdR7TwVvTkKrQ1bNPJD05086sIqdKZasaNW4JVac6/UmjlqhV6pFfgFV+LIFfkll190zR25Yq/k8uzW1fbd02vml15+4RUEjl7IK72QZ3xB99no18MReQaYu/SK/YrI0DPCQkew0K+QDD0jzPflqsMXRK5cwe30cpcUfm2G3BXY2woG3TWFZ4CdJdjt9Pr/rSneGLDEkYdkOVnaJBey4DkvMXvsrPdDAXtikR2VX7X5rk19a1KRTf1FBFU+E2GrKtHE/mtXRCe/2bzvRMq9PcjCG8mVqfPmT84r26fxXzt9ekrUGPlGpOSYEJYTiUVO5Mn7vTu5gjAs6cvQg8vOk7uWcSauLnClL9ONYPt7gdNnPZD/ArybTJ3KqCCppLxU6VLrrWy1mQRwl4RAfYIIRsksmYP4MiERvXqgt+l+PLQb9X48oKvEw/xXPBghZufEw/zN4sE9+nov8QCBTwGB3COyGwbEjaFvFTwJ/bHpuz70yF0NvhfoUeRs7N4We/eo8x1j374RPIk9GJ/AG2DvLurfC/YROAd7NLIbuA71Y0/VmGklV1yNqC95/GOj36neM1qSaevZJ1VEg6LGYDZMQNebGhV1ZhBWu66uzsfpsL1Fs+GCYInLWv18XvaLx7n+/SJoTlUkTJp303jf+qjGa9w0xVrzk+gsr7BRM6fttRT8mSw446KZ+1JH84oy9srUQ0d3ZCMUhm3aNqyHrrGgKWafGM01UGuaZc1NAltDqhDRAT/YYVbtjUAzS8vcmnOG69pe14OcSzDoHkLCkS0pGIEQXgVC95Do5yG8OoMPRM1bxWt194DgS6a/F+puIo+y6CF5faz6FHaITaODj+3fNsILUTcDA+ZGj0HGmLvKMUjonnyXDT4Pmhcwdicxloy+jAKpp3dqBdfMMbKSLkRPG/2cqg89pYSyD/UPIT8E4OPHgznsQdV0eHkfdAOaqYEneuBAi6pc6LxBx7wZJ7xH7rmwt6A2Dp8AeuzpPlyDHSO8F0PBpYCOhkCPrl8T6AId/zzQKtn9o6nJ6/1rDD3+Cw==&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" viewBox="0 0 691 163" style="cursor:pointer;max-width:100%;max-height:163px;"><defs/><g transform="translate(0.5,0.5)"><rect x="0.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(21.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">2</text></switch></g><rect x="50.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(71.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="100.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(121.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">4</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">4</text></switch></g><rect x="150.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(171.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="200.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(221.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">6</text></switch></g><rect x="250.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(271.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">7</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">7</text></switch></g><rect x="300.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(321.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><rect x="350.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(368.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">11</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">11</text></switch></g><rect x="400.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(418.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">67</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">67</text></switch></g><rect x="450.5" y="0" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(468.5,13.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">43</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">43</text></switch></g><rect x="0.5" y="120" width="150" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(72.5,133.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="3" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="150.5" y="120" width="150" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(222.5,133.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="3" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">2</text></switch></g><rect x="450.5" y="120" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(471.5,133.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="300.5" y="120" width="150" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(372.5,133.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="3" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><path d="M 76 72 L 76 113.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 76 118.88 L 72.5 111.88 L 76 113.63 L 79.5 111.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 90.5 -2.5 L 88.1 -2.5 Q 85.7 -2.5 85.7 7.5 L 85.7 50 Q 85.7 60 75.7 60 L 68.1 60 Q 60.5 60 70.5 60 L 78.1 60 Q 85.7 60 85.7 70 L 85.7 112.5 Q 85.7 122.5 88.1 122.5 L 90.5 122.5" fill="none" stroke="#000000" stroke-miterlimit="10" transform="rotate(270,75.5,60)" pointer-events="none"/><path d="M 226 72 L 226 113.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 226 118.88 L 222.5 111.88 L 226 113.63 L 229.5 111.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 240.5 -2.5 L 238.1 -2.5 Q 235.7 -2.5 235.7 7.5 L 235.7 50 Q 235.7 60 225.7 60 L 218.1 60 Q 210.5 60 220.5 60 L 228.1 60 Q 235.7 60 235.7 70 L 235.7 112.5 Q 235.7 122.5 238.1 122.5 L 240.5 122.5" fill="none" stroke="#000000" stroke-miterlimit="10" transform="rotate(270,225.5,60)" pointer-events="none"/><path d="M 373 72 L 373 98 L 376 98 L 376 113.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 376 118.88 L 372.5 111.88 L 376 113.63 L 379.5 111.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 388 -2.5 L 385.6 -2.5 Q 383.2 -2.5 383.2 7.5 L 383.2 50 Q 383.2 60 373.2 60 L 365.6 60 Q 358 60 368 60 L 375.6 60 Q 383.2 60 383.2 70 L 383.2 112.5 Q 383.2 122.5 385.6 122.5 L 388 122.5" fill="none" stroke="#000000" stroke-miterlimit="10" transform="rotate(270,373,60)" pointer-events="none"/><path d="M 476 72 L 476 98 L 476 113.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 476 118.88 L 472.5 111.88 L 476 113.63 L 479.5 111.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 490.5 45 L 488.1 45 Q 485.7 45 485.7 52.5 L 485.7 56.25 Q 485.7 60 475.7 60 L 468.1 60 Q 460.5 60 470.5 60 L 478.1 60 Q 485.7 60 485.7 67.5 L 485.7 71.25 Q 485.7 75 488.1 75 L 490.5 75" fill="none" stroke="#000000" stroke-miterlimit="10" transform="rotate(270,475.5,60)" pointer-events="none"/><g transform="translate(510.5,6.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="79" height="27" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 24px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="line-height: 20% ; font-size: 14px" face="Comic Sans MS">Original array</font><br /></div></div></foreignObject><text x="40" y="26" fill="#000000" text-anchor="middle" font-size="24px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(508.5,126.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="138" height="27" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 24px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font style="line-height: 0% ; font-size: 14px" face="Comic Sans MS">Decomposed Odd Count</font></div></div></foreignObject><text x="69" y="26" fill="#000000" text-anchor="middle" font-size="24px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(509.5,50.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="175" height="48" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 176px; white-space: nowrap; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">n = 10<br /><div style="text-align: left">buckets = ceil(sqrt(10)) = 4</div><div style="text-align: left">bucket size = ceil(10 / 4) = 3</div></div></div></foreignObject><text x="88" y="31" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
</div>

Now for each bucket, we can compute the count of odd numbers in that bucket. As there can be maximum of $$1415$$ buckets, we will have $$1415$$ counts of odd numbers.

Now whenever we will receive the query of type 1, we can update the corresponding number in the original array and depending upon
whether the new number is odd or even, we can either increase or decrease the odd number count of the corresponding bucket. This operation
can be done $$O(1)$$ time.

When we receive a query of type 2, instead of iterating over whole array like we were doing in the brute force approach, we can instead take use of our odd number count that we precalculated.

Suppose we need to find the $$100^{th}$$ odd number and assume that it exists at position $$10 ^ 6$$.
We will iterate over our decomposed counter array and maintain a cumulative sum of the total odd numbers seen till now. When we have seen at least $$100$$ odd numbers, we can then break and loop for that particular bucket which caused the sum to exceed $$100$$ and find the corresponding element position. This way we will just have to iterate for $$\lceil\frac{10 ^ 6}{1414}\rceil=708$$ buckets, then over atmost $$1414$$ elements inside that last bucket. Compare that to the $$10 ^ 6$$ lookups done by the brute force approach.

Time complexity for this operation will be thus $$O(NumBuckets + BucketSize)$$. Since number of buckets and bucket size are almost the same, we can say that complexity is $$O(NumBuckets)=O(\sqrt{n})$$.

<div class="img_container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="508px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36&quot; version=&quot;8.4.7&quot; editor=&quot;www.draw.io&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;8ee56939-83ff-e9b6-096b-969fae3cb7b7&quot; name=&quot;Page-1&quot;&gt;7VrLdtowEP0aL9vjN7AMNGkXfeQcFm2Wwha2WtuiQgTo11eyJb8GElJe6jmwINbIGos79w6jIZY3yTcfGVqkX2iMM8u1443lfbBcdzSyxbs0bCtDEA4qQ8JIXJmcxjAlf7AyqnXJisR42bmRU5pxsugaI1oUOOIdG2KMrru3zWnWfeoCJRgYphHKoPU7iXlaWYeB3dg/YZKk+smOrWZmKPqVMLoq1PMs15uXr2o6R9qXun+ZopiuWybv3vImjFJeXeWbCc4ktBq2at3Dntl63wwX/JAFbuSHnj8cYicY2oPZ7J0bVi6eUbZSYLhqq3yr4Sk/IJYubMsbr1PC8XSBIjm7FnwQtpTnmRg54jKiOYnUrco3Zhxv9u7YqXEQ9MI0x5xtxS16gaegU9TyBmq8bgKl45S2YuQrG1LUSGrPDTziQiF0KFoDgJZjFlpDk9AaArR8o9ByjeLWCKAVmIWWSdzSkWuhFRqFlmcStzwHoDUwCy2juOUCtDyj0PKN4pYHvxPN+lL0jSKXDxOXWVoMjGJXAODyzRJjYBS7YDlvlhb75by7Ay3ncnDBet6s00+/5royXLCgN4tdfS3ugutiaAUjgA2OEzxVQ8p4ShNaoOy+sY676LWQwhvCf0jz+0CNnvRMIXbampLDJ+XgJ+Z8q/otaMWpMDXP/UzpQvlYckZ/4QnNKCt36tl2KF5iZk4Lrhw4vhr37ptM6ujJD/hy7AQedMUivI9iCjSOWIL5iyUHZAHDGeLkubuD0yoAHtLM+jbql4bXTRgBBOckEhi1JNAI4hEzIvaMmVraEsaoI4xGJ/0l5unlCJarpY+UCI81Q0I76NYruvzULip9qlVuq5f4VkeVhoGjkkX15/lHYsE6x3LDjCvALdkq1piHv1eyvTou0ZevtilM5N8HUsSkSMQQ5VKfxWy5KKftQIjGtb/FsXj/uspnginqOWLP1aMqF4DoQsO8y98uaQpaSLbPSZb1TCgjSSGGkWCCZOZYZgQSoexOTeQkjkup7MotXfkkGVou1XU71byNpsed7Z1uSnJ2pSR/CFOSe46UFMLGEcxRRXwnf1WQMZD4SdT2B/Ky6n+lktG2I5MEKNODXiwOTRKgIus7OmOSCGHXayLEIXcHe4X/uVzLvHaibkk3rdcybDHP38G886gVtuJ0COHJ4xZCvSAcGRRC+JvPCWpAfV3Vc4O6oKvnmmKvnLxAYdeJ39EHIc38Fw9C1U3XOAiFsC+nhQlr/pswdSnk9r4NrypMWEPrEOJNhHG8lPXvLZh7m01u7/zjXTOYsJN5K2tBNdrvjvj9rsfBZa3ziqNzlrWwC6t1myMepfim2zcVuH54Nt2KYfO/XVXsm/+f8+7/Ag==&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" viewBox="0 0 508 328" style="cursor:pointer;max-width:100%;max-height:328px;"><defs/><g transform="translate(0.5,0.5)"><rect x="7" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(28.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">2</text></switch></g><rect x="57" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(78.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="107" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(128.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">4</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">4</text></switch></g><rect x="157" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(178.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">5</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">5</text></switch></g><rect x="207" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(228.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">6</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">6</text></switch></g><rect x="257" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(278.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">7</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">7</text></switch></g><rect x="307" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(328.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><rect x="357" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(374.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">11</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">11</text></switch></g><rect x="407" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(424.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">67</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">67</text></switch></g><rect x="457" y="205" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(474.5,218.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">43</div></div></foreignObject><text x="7" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">43</text></switch></g><rect x="7" y="105" width="150" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(78.5,118.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="3" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><rect x="157" y="105" width="150" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(228.5,118.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">2</div></div></foreignObject><text x="3" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">2</text></switch></g><rect x="457" y="105" width="50" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(478.5,118.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 7px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">1</text></switch></g><path d="M 382 145 L 382 198.63" fill="none" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><path d="M 382 203.88 L 378.5 196.88 L 382 198.63 L 385.5 196.88 Z" fill="#006666" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><rect x="307" y="105" width="150" height="40" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(378.5,118.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="6" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">3</div></div></foreignObject><text x="3" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">3</text></switch></g><path d="M 482 202 L 482 202" fill="none" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><path d="M 482 202 L 482 202 L 482 202 L 482 202 Z" fill="#006666" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(187.5,-1.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="146" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 102, 204); line-height: 1.2; vertical-align: top; width: 146px; white-space: normal; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><font color="#000000">FindingÂ  5th Odd Number</font></div></div></foreignObject><text x="73" y="23" fill="#0066CC" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 7 85 L 450.63 85" fill="none" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><path d="M 455.88 85 L 448.88 88.5 L 450.63 85 L 448.88 81.5 Z" fill="#006666" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(362.5,48.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="39" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 39px; white-space: normal; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Count 6</div></div></foreignObject><text x="20" y="23" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">Count 6</text></switch></g><g transform="translate(46.5,48.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="39" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 39px; white-space: normal; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Count 1</div></div></foreignObject><text x="20" y="23" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">Count 1</text></switch></g><path d="M 86 70 L 86 70" fill="none" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><path d="M 86 70 L 86 70 L 86 70 L 86 70 Z" fill="#006666" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(197.5,48.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="39" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 39px; white-space: normal; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Count 3</div></div></foreignObject><text x="20" y="23" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">Count 3</text></switch></g><g transform="translate(395.5,150.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="53" height="48" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 53px; white-space: normal; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Count exceeds 5</div></div></foreignObject><text x="27" y="31" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">Count exceeds 5</text></switch></g><path d="M 307 275 L 380.63 275" fill="none" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><path d="M 385.88 275 L 378.88 278.5 L 380.63 275 L 378.88 271.5 Z" fill="#006666" stroke="#006666" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(354.5,280.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="54" height="48" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 54px; white-space: normal; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Count matches 5</div></div></foreignObject><text x="27" y="31" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">Count matches 5</text></switch></g></g></svg>
</div>

Overall complexity of the algorithm will be thus the time for precomputation of the buckets odd counts plus the time to answer the queries. The complexity then is $$O(n + q\sqrt{n})$$.


Here is a sample implementation of the above strategy in Python 3.
{% highlight python %}
import math
n, q = list(map(int, input().strip().split(' ')))
array = list(map(int, input().strip().split(' ')))
# Taking ceil, to cover the last bucket also
buckets = int(math.ceil(math.sqrt(n)))
bucket_size = int(math.ceil(n / buckets))
odd_count = [0 for _ in range(buckets)]
# Precalculate buckets odd number count
for bucket in range(buckets):
    start = bucket * bucket_size
    # Taking into fact that last bucket might have less number of elements than bucket_size
    end = min(n, start + bucket_size)
    for index in range(start, end):
        if array[index] & 1 > 0:
            odd_count[bucket] += 1
for i in range(q):
    typ, k = list(map(int, input().strip().split(' ')))
    if typ == 1:
        k -= 1
        array[k] += 1
        # Update the odd count for the corresponding bucket
        bucket = k // bucket_size
        odd_count[bucket] += 1 if (array[k] & 1 > 0) else -1
    else:
        cnt = 0
        found_at = -1
        for index, count in enumerate(odd_count):
            cnt += count
            if cnt >= k:
                # Then dig deeper into the corresponding bucket to find the kth element
                bucket = index
                start = bucket * bucket_size
                end = min(n, start + bucket_size)
                # Decrease the count to count again for the current bucket
                cnt -= count
                for j in range(start, end):
                    if array[j] & 1 > 0:
                        cnt += 1
                        if cnt == k:
                            found_at = j + 1 # 1-based indexing
                            break
                break
        print(found_at)
{% endhighlight %}


You can find more problems related to Square root decomposition [here].

Thank you for reading my article. Let me know if you liked my article or any other suggestions for me, in the comments section below. And please, feel free to share :)

[Problem Statement]: https://www.hackerearth.com/practice/data-structures/advanced-data-structures/segment-trees/practice-problems/algorithm/help-mona/
[HackerEarth]: https://www.hackerearth.com
[here]: https://www.hackerearth.com/practice/algorithms/advanced-algorithms/square-root-decomposition/practice-problems/